(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3772],{4943:e=>{e.exports={afficheursContainer:"Afficheurs_afficheursContainer__7hoq4",departuresBackground:"Afficheurs_departuresBackground__ao7rk",arrivalsBackground:"Afficheurs_arrivalsBackground__6HzGE",errorMessage:"Afficheurs_errorMessage__elgey",loadingMessage:"Afficheurs_loadingMessage__TX23U",noSchedulesMessage:"Afficheurs_noSchedulesMessage__Z82Ic",scheduleList:"Afficheurs_scheduleList__oa76l",scheduleRow:"Afficheurs_scheduleRow__GyX7e",scheduleRowEven:"Afficheurs_scheduleRowEven__kN8QM",scheduleRowOdd:"Afficheurs_scheduleRowOdd__hCLJM",leftSection:"Afficheurs_leftSection__eUYnS",middleSection:"Afficheurs_middleSection__gmje6",rightSection:"Afficheurs_rightSection__27GRF",logoContainer:"Afficheurs_logoContainer__Ms868",statusText:"Afficheurs_statusText__Sb3Sf",retardeStatus:"Afficheurs_retardeStatus__f87ci",statusTextHighlight:"Afficheurs_statusTextHighlight__8cfWZ",trainTypeNameContainer:"Afficheurs_trainTypeNameContainer__MMe_1",departureTime:"Afficheurs_departureTime__VF3dX",destination:"Afficheurs_destination__4a_qm",viaContainer:"Afficheurs_viaContainer__sriqI",viaText:"Afficheurs_viaText__eI_0J",marquee:"Afficheurs_marquee__YHg6m",marqueeContent:"Afficheurs_marqueeContent__CN00k",marqueeAnimation:"Afficheurs_marqueeAnimation__q8rXj",limitedWidth:"Afficheurs_limitedWidth__tqJBo",marqueeStation:"Afficheurs_marqueeStation__B7hUv",marqueeSeparator:"Afficheurs_marqueeSeparator__7ewEC",statusSupprimeDistinct:"Afficheurs_statusSupprimeDistinct__4KEV9",statusDelayedDistinct:"Afficheurs_statusDelayedDistinct__1h3Hs",trainNumberBelow:"Afficheurs_trainNumberBelow__lwVYj",delayDuration:"Afficheurs_delayDuration___V3XV",yellowText:"Afficheurs_yellowText__kw1S_",alternatingTextContainer:"Afficheurs_alternatingTextContainer__BC8u7",trainTypeText:"Afficheurs_trainTypeText__Txshy",trainNumberText:"Afficheurs_trainNumberText__m30gH",sncfLogoContainer:"Afficheurs_sncfLogoContainer__IGUxT",servedStations:"Afficheurs_servedStations__aqFgH",stationName:"Afficheurs_stationName__brSgF",dotSeparator:"Afficheurs_dotSeparator__uRzoV",statusBar:"Afficheurs_statusBar__lDIcs",statusBarOnTime:"Afficheurs_statusBarOnTime__Yjfl4",statusBarDelayed:"Afficheurs_statusBarDelayed__ABIM0",statusTextContainer:"Afficheurs_statusTextContainer__aBnRo",statusOnTime:"Afficheurs_statusOnTime__SnJ4x",statusDelayed:"Afficheurs_statusDelayed__sBzUz",statusCancelled:"Afficheurs_statusCancelled__ibryu",delayBadge:"Afficheurs_delayBadge__itu3M"}},5364:(e,a,t)=>{"use strict";t.d(a,{$t:()=>u,Ag:()=>o,Cy:()=>c,EU:()=>n,Ix:()=>h,JS:()=>l,Kg:()=>m,Os:()=>r,TP:()=>f,oP:()=>d});let r=()=>JSON.parse(localStorage.getItem("schedules")||"[]"),s=e=>e&&e.trainNumber&&e.departureStation&&e.arrivalStation&&e.departureTime&&e.arrivalTime,i=e=>{let a;if(!e)return[];if("string"==typeof e)try{a=JSON.parse(e)}catch(e){return console.error("Failed to parse servedStations",e),[]}else a=e;return Array.isArray(a)?a.map(e=>"string"==typeof e?{name:e,arrivalTime:null,departureTime:null}:e).filter(e=>e&&e.name):[]},n=(e,a)=>{if(!e||!a)return e;let[t,r]=e.split(":").map(Number),s=60*t+r+a,i=Math.floor(s/60)%24;return"".concat(String(i).padStart(2,"0"),":").concat(String(s%60).padStart(2,"0"))},l=e=>e.isCancelled?{status:"cancelled",label:"Train supprim\xe9",className:"status-cancelled"}:e.delayMinutes?{status:"delayed",label:"Retard ".concat(e.delayMinutes," min"),className:"status-delayed",delayedTime:n(e.departureTime,e.delayMinutes)}:{status:"ontime",label:"\xc0 l'heure",className:"status-ontime"},u=e=>{try{if(!e)return[];return r().filter(s).filter(a=>a.departureStation===e||a.arrivalStation===e||i(a.servedStations).some(a=>a.name===e))}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration des horaires:",e),[]}},c=function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"departure",r=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(!e||!a)return null;try{if("departure"===t){if(e.departureStation===a)return e.isCancelled?e.departureTime:r&&e.delayMinutes?n(e.departureTime,e.delayMinutes):e.departureTime;let t=i(e.servedStations).find(e=>e.name===a);if(!t)return null;return r&&e.delayMinutes&&t.departureTime?n(t.departureTime,e.delayMinutes):t.departureTime||null}{if(e.arrivalStation===a)return e.isCancelled?e.arrivalTime:r&&e.delayMinutes?n(e.arrivalTime,e.delayMinutes):e.arrivalTime;let t=i(e.servedStations).find(e=>e.name===a);if(!t)return null;return r&&e.delayMinutes&&t.arrivalTime?n(t.arrivalTime,e.delayMinutes):t.arrivalTime||null}}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration de l'heure:",e),null}},o=function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"departures";if(!e||!a)return[];try{return e.filter(e=>!!s(e)&&("departures"===t?e.departureStation===a||i(e.servedStations).some(e=>e.name===a&&e.departureTime):e.arrivalStation===a||i(e.servedStations).some(e=>e.name===a&&e.arrivalTime)))}catch(e){return console.error("Erreur lors du filtrage des horaires:",e),[]}},d=function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"departures";if(!e||!a)return"";try{if("departures"===t){if(e.departureStation===a)return e.arrivalStation;let t=i(e.servedStations),r=t.findIndex(e=>e.name===a);if(-1!==r&&r<t.length-1)return t[r+1].name;return e.arrivalStation}{if(e.arrivalStation===a)return e.departureStation;let t=i(e.servedStations),r=t.findIndex(e=>e.name===a);if(r>0)return t[r-1].name;return e.departureStation}}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration de la destination/provenance:",e),""}},f=function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"departures";if(!e||!a)return[];try{return[...e].sort((e,r)=>{let s=c(e,a,"departures"===t?"departure":"arrival")||"",i=c(r,a,"departures"===t?"departure":"arrival")||"";return s.localeCompare(i)})}catch(a){return console.error("Erreur lors du tri des horaires:",a),e}},h=e=>{let a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],t=a.indexOf(e);return -1===t?null:a[(t+1)%a.length]},m=(e,a)=>e&&a?e.filter(e=>!e.joursCirculation||0===e.joursCirculation.length||e.joursCirculation.includes(a)):[]},8004:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>_});var r=t(7876),s=t(4232),i=t(9099),n=t(4587),l=t.n(n),u=t(4943),c=t.n(u),o=t(5364),d=t(3561);t(8230);var f=t(2507);let h=()=>["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date().getDay()],m=e=>{if(!e)return"";let[a,t]=e.split(":");return"".concat(a,":").concat(t)};function _(){let{gare:e,type:a}=(0,i.useRouter)().query,{servedStationsLines:t}=(0,s.useContext)(f.l),n=(0,d.N)(),u=n?n.trackAssignments:{},[_,p]=(0,s.useState)([]),[v,g]=(0,s.useState)([]),[T,y]=(0,s.useState)(!0),[S,x]=(0,s.useState)({}),[N,j]=(0,s.useState)(0),[C,A]=(0,s.useState)(null),M={TER:"TER","TGV InOui":"TGV InOui","TGV Lyria":"TGV Lyria","TGV Ouigo":"TGV Ouigo","OUIGO Trains Classiques":"OUIGO Trains Classiques",Intercités:"Intercit\xe9s",MOBIGO:"MOBIGO","Car TER":"Car TER"};if((0,s.useEffect)(()=>{let t;async function r(){try{let e=await fetch("/api/trainTypeLogos");if(e.ok){let a=await e.json();x(a)}}catch(e){console.error("Failed to fetch train type logos:",e)}}async function s(){if(e)try{let a=await fetch("/api/stations");if(!a.ok)throw Error("Failed to fetch stations: ".concat(a.status));let t=(await a.json()).find(a=>a.name===e);A(t||null)}catch(e){console.error("Failed to fetch station info:",e),A(null)}}async function i(){if(e&&("departures"===a||"arrivals"===a)){try{let t=await fetch("/api/schedules/by-station?station=".concat(e));if(!t.ok)throw Error("API request failed: ".concat(t.status));let r=(await t.json()).map(e=>{try{return{...e,joursCirculation:e.joursCirculation&&"string"==typeof e.joursCirculation?JSON.parse(e.joursCirculation):e.joursCirculation||[]}}catch(a){return console.warn("Failed to parse data for schedule ".concat(e.id),a),{...e,joursCirculation:[]}}}),s=(0,o.Ag)(r,e,a),i=h(),n=(0,o.Kg)(s,i),l=(0,o.TP)(n,e,a);p(l);let u=(0,o.Ix)(i);if(u){let t=(0,o.Kg)(s,u),r=(0,o.TP)(t,e,a);g(r)}else g([])}catch(e){console.error("Failed to fetch schedules:",e),p([]),g([])}y(!1)}else p([]),g([]),y(!1)}async function n(){await r(),await s(),await i()}return n(),t=setInterval(n,1e4),()=>clearInterval(t)},[e,a]),(0,s.useEffect)(()=>{let e=setInterval(()=>{j(e=>0===_.length?0:(e+1)%Math.ceil(_.length/10))},1e4);return()=>clearInterval(e)},[_]),!e)return(0,r.jsx)("main",{className:c().afficheursContainer,role:"main",children:(0,r.jsx)("p",{className:c().errorMessage,children:"Param\xe8tre gare manquant. Veuillez fournir la gare dans l'URL."})});if(!a||"departures"!==a&&"arrivals"!==a)return(0,r.jsx)("main",{className:c().afficheursContainer,role:"main",children:(0,r.jsx)("p",{className:c().errorMessage,children:"Param\xe8tre type manquant ou invalide. Utilisez 'departures' ou 'arrivals'."})});if(T)return(0,r.jsx)("main",{className:c().afficheursContainer,role:"main","aria-label":"Tableau des ".concat(a),children:(0,r.jsx)("p",{className:c().loadingMessage,children:"Chargement..."})});if(0===_.length)return(0,r.jsx)("main",{className:c().afficheursContainer,role:"main","aria-label":"Tableau des ".concat(a),children:(0,r.jsx)("p",{className:c().noSchedulesMessage,children:"Aucun horaire trouv\xe9 pour cette gare."})});let w=10*N,O=_.slice(w,w+10);return(0,r.jsxs)("main",{className:"".concat(c().afficheursContainer," ").concat("departures"===a?c().departuresBackground:c().arrivalsBackground),role:"main","aria-label":"Tableau des ".concat(a),children:[(0,r.jsx)("ul",{className:c().scheduleList,role:"list",children:O.map((t,s)=>{var i;let n=(0,o.JS)(t),d=M[t.trainType||"MOBIGO"]||"MOBIGO",f=S[d]||"/images/sncf-logo.png",h=(0,o.Cy)(t,e,"departures"===a?"departure":"arrival"),p=n.status;(()=>{if(!t.delayMinutes||t.delayMinutes<=0)return;let[e,a]=h.split(":").map(Number),r=new Date;r.setHours(e),r.setMinutes(a+t.delayMinutes);let s=r.getHours().toString().padStart(2,"0"),i=r.getMinutes().toString().padStart(2,"0");return"".concat(s,":").concat(i)})();let v=new Date,[g,T]=h.split(":").map(Number),y=new Date(v.getFullYear(),v.getMonth(),v.getDate(),g,T),x=(y-v)/6e4,N=_[_.length-1],[j,A]=(0,o.Cy)(N,e,"departures"===a?"departure":"arrival").split(":").map(Number),w=new Date(v.getFullYear(),v.getMonth(),v.getDate(),j,A);if(x<2&&x>=0||x<0&&y.getTime()!==w.getTime())return null;let O=[];if(t.servedStations&&t.servedStations.length>0){let r=t.servedStations.map(e=>"object"==typeof e?e.name:e),s=r.indexOf(e);"departures"===a?O=-1!==s?r.slice(s+1):r:"arrivals"===a&&(O=-1!==s?r.slice(0,s):r)}let b=x<=("Ville"===((null==C?void 0:C.locationType)||"Ville")?20:720)&&x>=0,B=b?(null==(i=u[t.id])?void 0:i[e])||t.track||"-":"";return(0,r.jsxs)("li",{className:"".concat(c().scheduleRow," ").concat(s%2==0?c().scheduleRowEven:c().scheduleRowOdd),role:"listitem",children:[(0,r.jsxs)("section",{className:c().leftSection,children:[(0,r.jsx)("div",{className:c().sncfLogoContainer,children:(0,r.jsx)(l(),{src:f,alt:d,layout:"fill",objectFit:"contain"})}),(0,r.jsxs)("div",{className:c().alternatingTextContainer,children:[(0,r.jsxs)("div",{className:c().trainTypeNameContainer,children:[(0,r.jsx)("div",{className:c().trainTypeText,children:d}),(0,r.jsx)("div",{className:c().trainNumberText,children:t.trainNumber||""})]}),"ontime"===p&&(0,r.jsx)("div",{className:c().statusText,children:"\xe0 l'heure"}),"delayed"===p&&(0,r.jsx)("div",{className:c().statusText,children:"Retard\xe9"}),"cancelled"===p&&(0,r.jsx)("div",{className:c().statusText,children:"Supprim\xe9"})]}),(0,r.jsx)("time",{className:c().departureTime,dateTime:h,style:{color:"#ffea00"},children:m(h)})]}),(0,r.jsxs)("section",{className:c().middleSection,children:[(0,r.jsx)("div",{className:c().destination,children:"departures"===a?t.arrivalStation:t.departureStation}),O.length>0&&(0,r.jsx)("div",{className:c().servedStations,children:(0,r.jsx)("div",{className:c().marquee,"aria-label":"Liste des gares desservies",role:"list",children:(0,r.jsx)("div",{className:c().marqueeContent,children:O.map((e,a)=>(0,r.jsxs)("span",{className:c().stationName,role:"listitem",children:[a>0&&(0,r.jsx)("span",{className:c().dotSeparator,"aria-hidden":"true",children:"•"}),e]},a))})})})]}),(0,r.jsx)("div",{className:c().rightSection,"aria-hidden":!b,children:B})]},t.id)})}),0===N&&v.length>0&&(0,r.jsxs)("section",{className:c().nextDaySection,children:[(0,r.jsxs)("p",{className:c().nextDayText,children:["Les prochains ",a," auront lieu demain."]}),(0,r.jsx)("ul",{className:c().scheduleList,role:"list",children:v.slice(0,10).map((t,s)=>{var i;let n=(0,o.JS)(t),d=M[t.trainType||"MOBIGO"]||"MOBIGO",f=S[d]||"/images/sncf-logo.png",h=(0,o.Cy)(t,e,"departures"===a?"departure":"arrival"),_=n.status;return(0,r.jsxs)("li",{className:"".concat(c().scheduleRow," ").concat(s%2==0?c().scheduleRowEven:c().scheduleRowOdd),role:"listitem",children:[(0,r.jsxs)("section",{className:c().leftSection,children:[(0,r.jsx)("div",{className:c().sncfLogoContainer,children:(0,r.jsx)(l(),{src:f,alt:d,layout:"fill",objectFit:"contain"})}),(0,r.jsxs)("div",{className:c().alternatingTextContainer,children:[(0,r.jsxs)("div",{className:c().trainTypeNameContainer,children:[(0,r.jsx)("div",{className:c().trainTypeText,children:d}),(0,r.jsx)("div",{className:c().trainNumberText,children:t.trainNumber||""})]}),"ontime"===_&&(0,r.jsx)("div",{className:c().statusText,children:"\xe0 l'heure"}),"delayed"===_&&(0,r.jsx)("div",{className:c().statusText,children:"Retard\xe9"}),"cancelled"===_&&(0,r.jsx)("div",{className:c().statusText,children:"Supprim\xe9"})]}),(0,r.jsx)("time",{className:c().departureTime,dateTime:h,style:{color:"#ffea00"},children:m(h)})]}),(0,r.jsxs)("section",{className:c().middleSection,children:[(0,r.jsx)("div",{className:c().destination,children:"departures"===a?t.arrivalStation:t.departureStation}),t.servedStations&&t.servedStations.length>0&&(0,r.jsx)("div",{className:c().servedStations,children:(0,r.jsx)("div",{className:c().marquee,"aria-label":"Liste des gares desservies",role:"list",children:(0,r.jsx)("div",{className:c().marqueeContent,children:(()=>{let s=t.servedStations.map(e=>"object"==typeof e?e.name:e),i=s.indexOf(e),n=[];return"departures"===a?n=-1!==i?s.slice(i+1):s:"arrivals"===a&&(n=-1!==i?s.slice(0,i):s),n.map((e,a)=>(0,r.jsxs)("span",{className:c().stationName,role:"listitem",children:[a>0&&(0,r.jsx)("span",{className:c().dotSeparator,"aria-hidden":"true",children:"•"}),e]},a))})()})})})]}),(0,r.jsx)("div",{className:c().rightSection,"aria-hidden":!0,children:(null==(i=u[t.id])?void 0:i[e])||t.track||"-"})]},t.id)})})]})]})}},8396:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/afficheurs/classiques/departs",function(){return t(8004)}])}},e=>{var a=a=>e(e.s=a);e.O(0,[8230,4587,636,6593,8792],()=>a(8396)),_N_E=e.O()}]);