(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8982],{2355:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>h});var t=r(7876),i=r(4232),s=r(9099),n=r(4587),l=r.n(n),o=r(7173),u=r.n(o),d=r(5364),c=r(3561);r(8230);var _=r(2507);let m=()=>["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date().getDay()],v=e=>{if(!e)return"";let[a,r]=e.split(":");return"".concat(a,":").concat(r)};function h(){let{gare:e}=(0,s.useRouter)().query,{servedStationsLines:a}=(0,i.useContext)(_.l),r=(0,c.N)(),n=r?r.trackAssignments:{},[o,h]=(0,i.useState)([]),[p,f]=(0,i.useState)(!0),[y,g]=(0,i.useState)({}),[S,T]=(0,i.useState)(0),[N,x]=(0,i.useState)(null);return((0,i.useEffect)(()=>{let a;async function r(){try{let e=await fetch("/api/trainTypeLogos");if(e.ok){let a=await e.json();g(a)}}catch(e){console.error("Failed to fetch train type logos:",e)}}async function t(){if(e)try{let a=await fetch("/api/stations");if(!a.ok)throw Error("Failed to fetch stations: ".concat(a.status));let r=(await a.json()).find(a=>a.name===e);x(r||null)}catch(e){console.error("Failed to fetch station info:",e),x(null)}}async function i(){if(e){try{let a=await fetch("/api/schedules/by-station?station=".concat(e));if(!a.ok)throw Error("API request failed: ".concat(a.status));let r=(await a.json()).map(e=>{try{return{...e,joursCirculation:e.joursCirculation&&"string"==typeof e.joursCirculation?JSON.parse(e.joursCirculation):e.joursCirculation||[]}}catch(a){return console.warn("Failed to parse data for schedule ".concat(e.id),a),{...e,joursCirculation:[]}}}),t=(0,d.Ag)(r,e,"arrivals"),i=m(),s=t.filter(e=>!e.joursCirculation||0===e.joursCirculation.length||e.joursCirculation.includes(i)),n=(0,d.TP)(s,e,"arrivals");h(n)}catch(e){console.error("Failed to fetch schedules:",e),h([])}f(!1)}else h([]),f(!1)}async function s(){await r(),await t(),await i()}return s(),a=setInterval(s,1e4),()=>clearInterval(a)},[e]),(0,i.useEffect)(()=>{let e=setInterval(()=>{T(e=>(e+1)%2)},2e3);return()=>clearInterval(e)},[]),e)?p?(0,t.jsx)("main",{className:u().afficheursContainer,role:"main","aria-label":"Tableau des d\xe9parts",children:(0,t.jsx)("p",{className:u().loadingMessage,children:"Chargement..."})}):0===o.length?(0,t.jsx)("main",{className:u().afficheursContainer,role:"main","aria-label":"Tableau des d\xe9parts",children:(0,t.jsx)("p",{className:u().noSchedulesMessage,children:"Aucun horaire trouv\xe9 pour cette gare."})}):(0,t.jsx)("main",{className:u().afficheursContainer,role:"main","aria-label":"Tableau des d\xe9parts",children:(0,t.jsx)("ul",{className:u().scheduleList,role:"list",children:o.map((a,r)=>{let i=(0,d.JS)(a),s=a.trainType||"MOBIGO",c=y[s]||"/images/sncf-logo.png",_=(0,d.Cy)(a,e,"arrival"),m=i.status;(()=>{if(!a.delayMinutes||a.delayMinutes<=0)return;let[e,r]=_.split(":").map(Number),t=new Date;t.setHours(e),t.setMinutes(r+a.delayMinutes);let i=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0");return"".concat(i,":").concat(s)})();let h=new Date,[p,f]=_.split(":").map(Number),g=new Date(h.getFullYear(),h.getMonth(),h.getDate(),p,f),T=(g-h)/6e4,x=o[o.length-1],[C,j]=(0,d.Cy)(x,e,"departure").split(":").map(Number),w=new Date(h.getFullYear(),h.getMonth(),h.getDate(),C,j);return T<2&&T>=0||T<0&&g.getTime()!==w.getTime()?null:(0,t.jsxs)("li",{className:"".concat(u().scheduleRow," ").concat(r%2==0?u().scheduleRowEven:u().scheduleRowOdd),role:"listitem",children:[(0,t.jsxs)("section",{className:u().leftSection,children:[(0,t.jsx)("div",{className:u().sncfLogoContainer,children:(0,t.jsx)(l(),{src:c,alt:s,layout:"fill",objectFit:"contain"})}),(0,t.jsx)("div",{className:u().alternatingTextContainer,children:0===S?(0,t.jsxs)("div",{className:u().trainTypeNameContainer,children:[(0,t.jsx)("div",{className:u().trainTypeText,children:s}),(0,t.jsx)("div",{className:u().trainNumberText,children:a.trainNumber||""})]}):(0,t.jsxs)(t.Fragment,{children:["ontime"===m&&(0,t.jsx)("div",{className:u().statusText,children:"\xe0 l'heure"}),"delayed"===m&&(0,t.jsx)("div",{className:u().statusText,children:"Retard\xe9"}),"cancelled"===m&&(0,t.jsx)("div",{className:u().statusText,children:"Supprim\xe9"})]})}),(0,t.jsx)("time",{className:u().departureTime,dateTime:_,style:{color:"#ffea00"},children:v(_)})]}),(0,t.jsxs)("section",{className:u().middleSection,children:[(0,t.jsx)("div",{className:u().destination,children:a.departureStation}),a.servedStations&&a.servedStations.length>0&&(0,t.jsx)("div",{className:u().servedStations,children:(0,t.jsx)("div",{className:u().marquee,"aria-label":"Liste des gares desservies",role:"list",children:(0,t.jsx)("div",{className:u().marqueeContent,children:(()=>{let r=[];if(a.servedStations&&a.servedStations.length>0){let t=a.servedStations.map(e=>"object"==typeof e?e.name:e),i=t.indexOf(e);r=-1!==i?t.slice(0,i):t}return r.map((e,a)=>(0,t.jsxs)("span",{className:u().stationName,role:"listitem",children:[a>0&&(0,t.jsx)("span",{className:u().dotSeparator,"aria-hidden":"true",children:"â€¢"}),e]},a))})()})})})]}),(()=>{var r;let i=new Date,[s,l]=_.split(":").map(Number),o=(new Date(i.getFullYear(),i.getMonth(),i.getDate(),s,l)-i)/6e4,d="Ville"===((null==N?void 0:N.locationType)||"Ville")?20:720;return(0,t.jsx)("div",{className:"".concat(u().rightSection," ").concat(o<=d&&o>=0?"":u().hiddenSquare),"aria-hidden":!(o<=d&&o>=0),children:o<=d&&o>=0?(null==(r=n[a.id])?void 0:r[e])||a.track||"-":""})})()]})})})}):(0,t.jsx)("main",{className:u().afficheursContainer,role:"main",children:(0,t.jsx)("p",{className:u().errorMessage,children:"Param\xe8tre gare manquant. Veuillez fournir la gare dans l'URL."})})}},5364:(e,a,r)=>{"use strict";r.d(a,{$t:()=>o,Ag:()=>d,Cy:()=>u,EU:()=>n,Ix:()=>m,JS:()=>l,Kg:()=>v,Os:()=>t,TP:()=>_,oP:()=>c});let t=()=>JSON.parse(localStorage.getItem("schedules")||"[]"),i=e=>e&&e.trainNumber&&e.departureStation&&e.arrivalStation&&e.departureTime&&e.arrivalTime,s=e=>{let a;if(!e)return[];if("string"==typeof e)try{a=JSON.parse(e)}catch(e){return console.error("Failed to parse servedStations",e),[]}else a=e;return Array.isArray(a)?a.map(e=>"string"==typeof e?{name:e,arrivalTime:null,departureTime:null}:e).filter(e=>e&&e.name):[]},n=(e,a)=>{if(!e||!a)return e;let[r,t]=e.split(":").map(Number),i=60*r+t+a,s=Math.floor(i/60)%24;return"".concat(String(s).padStart(2,"0"),":").concat(String(i%60).padStart(2,"0"))},l=e=>e.isCancelled?{status:"cancelled",label:"Train supprim\xe9",className:"status-cancelled"}:e.delayMinutes?{status:"delayed",label:"Retard ".concat(e.delayMinutes," min"),className:"status-delayed",delayedTime:n(e.departureTime,e.delayMinutes)}:{status:"ontime",label:"\xc0 l'heure",className:"status-ontime"},o=e=>{try{if(!e)return[];return t().filter(i).filter(a=>a.departureStation===e||a.arrivalStation===e||s(a.servedStations).some(a=>a.name===e))}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration des horaires:",e),[]}},u=function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"departure",t=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(!e||!a)return null;try{if("departure"===r){if(e.departureStation===a)return e.isCancelled?e.departureTime:t&&e.delayMinutes?n(e.departureTime,e.delayMinutes):e.departureTime;let r=s(e.servedStations).find(e=>e.name===a);if(!r)return null;return t&&e.delayMinutes&&r.departureTime?n(r.departureTime,e.delayMinutes):r.departureTime||null}{if(e.arrivalStation===a)return e.isCancelled?e.arrivalTime:t&&e.delayMinutes?n(e.arrivalTime,e.delayMinutes):e.arrivalTime;let r=s(e.servedStations).find(e=>e.name===a);if(!r)return null;return t&&e.delayMinutes&&r.arrivalTime?n(r.arrivalTime,e.delayMinutes):r.arrivalTime||null}}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration de l'heure:",e),null}},d=function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"departures";if(!e||!a)return[];try{return e.filter(e=>!!i(e)&&("departures"===r?e.departureStation===a||s(e.servedStations).some(e=>e.name===a&&e.departureTime):e.arrivalStation===a||s(e.servedStations).some(e=>e.name===a&&e.arrivalTime)))}catch(e){return console.error("Erreur lors du filtrage des horaires:",e),[]}},c=function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"departures";if(!e||!a)return"";try{if("departures"===r){if(e.departureStation===a)return e.arrivalStation;let r=s(e.servedStations),t=r.findIndex(e=>e.name===a);if(-1!==t&&t<r.length-1)return r[t+1].name;return e.arrivalStation}{if(e.arrivalStation===a)return e.departureStation;let r=s(e.servedStations),t=r.findIndex(e=>e.name===a);if(t>0)return r[t-1].name;return e.departureStation}}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration de la destination/provenance:",e),""}},_=function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"departures";if(!e||!a)return[];try{return[...e].sort((e,t)=>{let i=u(e,a,"departures"===r?"departure":"arrival")||"",s=u(t,a,"departures"===r?"departure":"arrival")||"";return i.localeCompare(s)})}catch(a){return console.error("Erreur lors du tri des horaires:",a),e}},m=e=>{let a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=a.indexOf(e);return -1===r?null:a[(r+1)%a.length]},v=(e,a)=>e&&a?e.filter(e=>!e.joursCirculation||0===e.joursCirculation.length||e.joursCirculation.includes(a)):[]},7173:e=>{e.exports={afficheursContainer:"arrivals_afficheursContainer__8u_Ah",scheduleRow:"arrivals_scheduleRow__1wrDf",leftSection:"arrivals_leftSection__d7T9L",middleSection:"arrivals_middleSection__WSs7I",rightSection:"arrivals_rightSection__7yvN5",departureTime:"arrivals_departureTime__2QoaM",destination:"arrivals_destination__gGgdR",servedStations:"arrivals_servedStations__Jle5R",statusText:"arrivals_statusText__x7Cds",errorMessage:"arrivals_errorMessage__xY_K1",loadingMessage:"arrivals_loadingMessage__sjG48",noSchedulesMessage:"arrivals_noSchedulesMessage__RwGXt",scheduleList:"arrivals_scheduleList__CJciD",scheduleRowEven:"arrivals_scheduleRowEven__4bWC1",scheduleRowOdd:"arrivals_scheduleRowOdd__fuNDz",logoContainer:"arrivals_logoContainer__YGfDT",retardeStatus:"arrivals_retardeStatus__PY7Qo",statusTextHighlight:"arrivals_statusTextHighlight___k2YA",trainTypeNameContainer:"arrivals_trainTypeNameContainer__q8NyB",viaContainer:"arrivals_viaContainer__Gx70S",viaText:"arrivals_viaText__F80qS",marquee:"arrivals_marquee__WR0YN",marqueeContent:"arrivals_marqueeContent__K_hyW",marqueeAnimation:"arrivals_marqueeAnimation__t2nqP",limitedWidth:"arrivals_limitedWidth__OrqgL",marqueeStation:"arrivals_marqueeStation__3_QFL",marqueeSeparator:"arrivals_marqueeSeparator__FqsOm",statusSupprimeDistinct:"arrivals_statusSupprimeDistinct__rc7AI",statusDelayedDistinct:"arrivals_statusDelayedDistinct__RsIaP",trainNumberBelow:"arrivals_trainNumberBelow__ipiS1",delayDuration:"arrivals_delayDuration__hDYJh",yellowText:"arrivals_yellowText__dvsOd",alternatingTextContainer:"arrivals_alternatingTextContainer__ChZHb",trainTypeText:"arrivals_trainTypeText__8UeQa",trainNumberText:"arrivals_trainNumberText__rSQza",sncfLogoContainer:"arrivals_sncfLogoContainer__LRBDg",stationName:"arrivals_stationName__NliFS",dotSeparator:"arrivals_dotSeparator__YjBJZ",statusBar:"arrivals_statusBar__p3ViN",statusBarOnTime:"arrivals_statusBarOnTime___M9dm",statusBarDelayed:"arrivals_statusBarDelayed__YdFYq",statusTextContainer:"arrivals_statusTextContainer__bly0Z",statusOnTime:"arrivals_statusOnTime__vfNbU",statusDelayed:"arrivals_statusDelayed__T5WR9",statusCancelled:"arrivals_statusCancelled__wPfdy",delayBadge:"arrivals_delayBadge__rzxUw"}},7976:(e,a,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/afficheurs/classiques/arrivees",function(){return r(2355)}])}},e=>{var a=a=>e(e.s=a);e.O(0,[8230,4587,636,6593,8792],()=>a(7976)),_N_E=e.O()}]);